<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        /* Dark theme background  */
        background: linear-gradient(to bottom, #121212, #333333);
        color: #ffffff;
        line-height: 1.6;
        overflow-y: auto;
        /* Prevent scrollbar issues  */
    }

    header {
        background-color: rgba(30, 30, 30, 0.85);
        /* Dark theme container color */
        color: #ffffff;
        padding: 1em 2em;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #00ffff;
        /* Cyan highlight */
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        /* Soften shadow  */
    }

    header h1 {
        margin: 0;
        font-size: 1.8em;
        /* Dark theme h2 styles  */
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
    }

    nav ul li {
        margin-left: 1.5em;
    }

    nav ul li a {
        color: #00ffff;
        text-decoration: none;
        display: flex;
        align-items: center;
        transition: color 0.3s ease;
    }

    nav ul li a:hover {
        color: #ffffff;
    }

    nav ul li a i {
        margin-right: 0.5em;
    }

    nav ul li a.active {
        font-weight: bold;
    }

    nav ul li button {
        background: none;
        color: #00ffff;
        border: none;
        padding: 0;
        font-size: inherit;
        cursor: pointer;
        display: flex;
        align-items: center;
        transition: color 0.3s ease;
    }

    nav ul li button:hover {
        color: #ffffff;
    }

    nav ul li button i {
        margin-right: 0.5em;
    }

    main {
        padding: 2em;
        position: relative;
    }

    .welcome-section {
        background: rgba(30, 30, 30, 0.85);
        /* Dark theme container color */
        padding: 1.5em;
        margin-bottom: 2em;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
        /* Darker shadow */
        display: flex;
        align-items: center;
        border-left: 3px solid #00ffff;
        /* Cyan highlight */
    }

    .welcome-section img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 10px;
        vertical-align: middle;
        object-fit: cover;
        border: 2px solid #666666;
        /* Input border color */
    }

    .welcome-text {
        display: flex;
        flex-direction: column;
    }

    .welcome-text h2 {
        margin-top: 0;
        color: #ffffff;
        margin-bottom: 0.1em;
        margin-right: 10px;
        /* Dark theme h2 styles  */
        font-size: 1.5em;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .welcome-text p {
        margin-bottom: 0;
        font-size: 0.9em;
        color: #aaaaaa;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        /* Text shadow */
    }

    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1em;
        margin-bottom: 2em;
    }

    .stat-card {
        background: rgba(30, 30, 30, 0.85);
        /* Dark theme container color */
        padding: 1em;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
        /* Darker shadow */
        text-align: center;
        border-top: 2px solid #00ffff;
        /* Cyan highlight */
    }

    .stat-card h3 {
        margin-top: 0;
        color: #cccccc;
        font-size: 1.1em;
        margin-bottom: 0.5em;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        /* Text shadow */
    }

    .stat-card p {
        font-size: 1.5em;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 0.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        /* Stronger shadow */
    }

    .stat-card .stat-link {
        display: inline-flex;
        align-items: center;
        color: #00ffff;
        text-decoration: none;
        font-size: 0.9em;
        transition: color 0.3s ease;
    }

    .stat-card .stat-link:hover {
        color: #ffffff;
    }

    .stat-card .stat-link i {
        margin-left: 0.3em;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2em;
        margin-bottom: 2em;
    }

    .recent-transactions,
    .quick-actions,
    .recently-added {
        background: rgba(30, 30, 30, 0.85);
        /* Dark theme container color */
        padding: 1.5em;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
        /* Darker shadow */
        border-bottom: 2px solid #00ffff;
        /* Cyan highlight */
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1em;
        border-bottom: 2px solid #00ffff;
        /* Cyan highlight */
        padding-bottom: 0.5em;
    }

    .section-header h2 {
        margin: 0;
        color: #ffffff;
        font-size: 1.4em;
        /* Dark theme h2 styles  */
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .section-header .view-all {
        color: #00ffff;
        text-decoration: none;
        font-size: 0.9em;
        transition: color 0.3s ease;
    }

    .section-header .view-all:hover {
        color: #ffffff;
    }

    .table-container {
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th,
    td {
        padding: 0.8em;
        border-bottom: 1px solid #666666;
        /* Input border color */
        text-align: left;
        color: #cccccc;
        /* Label color  */
    }

    th {
        background-color: rgba(255, 255, 255, 0.1);
        /* Input background  */
        font-weight: 600;
        /* Label font weight  */
        color: #cccccc;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        /* Label text shadow  */
    }

    tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
        /* Slightly lighter on hover  */
    }

    .overdue {
        color: #ff4da6;
        /* Pink from button gradient  */
        font-weight: bold;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1em;
    }

    .action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(to right, #4d4dff, #ff4da6);
        /* Button gradient */
        padding: 1em;
        border-radius: 8px;
        text-decoration: none;
        color: #ffffff;
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        /* Button shadow */
    }

    .action-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
        /* Stronger shadow  */
    }

    .action-card i {
        font-size: 1.8em;
        margin-bottom: 0.5em;
        color: #ffffff;
    }

    .action-card span {
        font-size: 0.9em;
    }

    .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1em;
    }

    .book-card {
        background: rgba(30, 30, 30, 0.85);
        /* Dark theme container color */
        padding: 1em;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
        /* Darker shadow */
        text-align: center;
        border-left: 2px solid #00ffff;
        /* Cyan highlight */
    }

    .book-cover {
        width: 80px;
        height: 100px;
        background-color: #666666;
        /* Input border color */
        border-radius: 4px;
        margin: 0 auto 0.5em;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .book-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .book-card h3 {
        font-size: 1em;
        margin-bottom: 0.3em;
        color: #ffffff;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        /* Dark theme h2 styles (reduced)  */
        font-weight: 600;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .book-card .book-author {
        color: #aaaaaa;
        font-size: 0.8em;
        margin-bottom: 0.5em;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        /* Text shadow */
    }

    .book-card .book-status {
        font-size: 0.8em;
        padding: 0.3em 0.6em;
        border-radius: 4px;
        font-weight: bold;
    }

    .book-card .book-status.available {
        background-color: rgba(76, 175, 80, 0.2);
        /* Green tint */
        color: #ffffff;
    }

    .book-card .book-status.checked_out {
        background-color: rgba(244, 67, 54, 0.2);
        /* Red tint */
        color: #ffffff;
    }

    .book-card .book-link {
        display: inline-block;
        margin-top: 0.5em;
        color: #00ffff;
        text-decoration: none;
        font-size: 0.9em;
        transition: color 0.3s ease;
    }

    .book-card .book-link:hover {
        color: #ffffff;
    }

    /* Loading Overlay Styles */
    .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        /* Darker overlay */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }

    .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #00ffff;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .hidden {
        display: none !important;
    }

    /* Popup Styles  */
    .popup {
        position: fixed;
        bottom: 15px;
        right: 15px;
        background-color: rgba(0, 0, 0, 0.8);
        color: #ffffff;
        padding: 10px 15px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        border-left: 5px solid #00ffff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85em;
    }

    .popup p {
        margin: 0;
        flex-grow: 1;
    }

    .popup button {
        background: none;
        border: none;
        color: #ffffff;
        cursor: pointer;
        font-size: 1em;
        margin-left: 10px;
        opacity: 0.8;
        transition: opacity 0.2s ease;
    }

    .popup button:hover {
        opacity: 1;
    }

    /* Loading Buffer Styles */
    .loading-buffer {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.9);
        color: #ffffff;
        padding: 15px;
        border-radius: 10px;
        z-index: 999;
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #00ffff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
        margin-bottom: 10px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .loading-buffer p {
        font-size: 1em;
        font-weight: 600;
    }
</style>
</head>
<body>
    <header>
        <h1>Library Management System</h1>
        <nav>
            <ul>
                <li><a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="books.html"><i class="fas fa-book"></i> Books</a></li>
                <li><a href="members.html"><i class="fas fa-users"></i> Members</a></li>
                <li><a href="transactions.html"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
                <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>
                <li><button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
            </ul>
        </nav>
    </header>
    <main>
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner"></div>
        </div>

        <section class="welcome-section">
            <img id="profileImage" src="" alt="Admin Profile">
            <div class="welcome-text">
                <h2 id="adminName">Administrator</h2>
                <p id="currentDate"></p>
            </div>
        </section>

        <section class="stats">
            <div class="stat-card">
                <h3>Total Books</h3>
                <p id="totalBooks">0</p>
                <a href="books.html" class="stat-link">View All Books <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="stat-card">
                <h3>Available Books</h3>
                <p id="availableBooks">0</p>
                <a href="books.html?status=available" class="stat-link">View Available <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="stat-card">
                <h3>Total Members</h3>
                <p id="totalMembers">0</p>
                <a href="members.html" class="stat-link">View All Members <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="stat-card">
                <h3>Active Checkouts</h3>
                <p id="activeCheckouts">0</p>
                <a href="transactions.html?status=active" class="stat-link">View Checkouts <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="stat-card">
                <h3>Overdue Books</h3>
                <p id="overdueBooks">0</p>
                <a href="transactions.html?status=overdue" class="stat-link">View Overdue <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="stat-card">
                <h3>Outstanding Fines</h3>
                <p id="totalFines">₹0</p>
                <a href="reports.html#fines" class="stat-link">View Fines <i class="fas fa-arrow-right"></i></a>
            </div>
        </section>

        <div class="dashboard-grid">
            <section class="recent-transactions">
                <div class="section-header">
                    <h2>Recent Transactions</h2>
                    <a href="transactions.html" class="view-all">View All</a>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Book</th>
                                <th>Checkout Date</th>
                                <th>Due Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="quick-actions">
                <div class="section-header">
                    <h2>Quick Actions</h2>
                </div>
                <div class="actions-grid">
                    <a href="books.html?action=add" class="action-card">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add New Book</span>
                    </a>
                    <a href="members.html?action=add" class="action-card">
                        <i class="fas fa-user-plus"></i>
                        <span>Register Member</span>
                    </a>
                    <a href="transactions.html?action=checkout" class="action-card">
                        <i class="fas fa-book-reader"></i>
                        <span>Checkout Book</span>
                    </a>
                    <a href="transactions.html?action=return" class="action-card">
                        <i class="fas fa-book"></i>
                        <span>Return Book</span>
                    </a>
                </div>
            </section>
        </div>

        <section class="recently-added">
            <div class="section-header">
                <h2>Recently Added Books</h2>
                <a href="books.html" class="view-all">View All</a>
            </div>
            <div class="books-grid" id="recentBooks">
            </div>
        </section>
    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBPQ67r9mMz-x8fOCXozbVGMW_de81b0_8",
        authDomain: "stakehub-fc6be.firebaseapp.com",
        databaseURL: "https://stakehub-fc6be-default-rtdb.firebaseio.com",
        projectId: "stakehub-fc6be",
        storageBucket: "stakehub-fc6be.appspot.com",
        messagingSenderId: "99090758331124",
        appId: "1:990758331124:android:11851d9fb54fa6d8eef4a1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Get a reference to the Firebase Realtime Database root
    const dbRef = firebase.database().ref();

    // Define constants for book status
    const BOOK_STATUS = {
        AVAILABLE: 'available',
        CHECKED_OUT: 'checked_out'
    };

    document.addEventListener('DOMContentLoaded', () => {
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Function to show loading overlay
        const showLoading = () => {
            loadingOverlay.classList.remove('hidden');
        };

        // Function to hide loading overlay
        const hideLoading = () => {
            loadingOverlay.classList.add('hidden');
        };

        // Function to get URL parameters
        function getUrlParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const adminUidFromUrl = getUrlParam('uid');

        firebase.auth().onAuthStateChanged(user => {
            showLoading(); // Show loading initially
            if (user) {
                // User is signed in. Now, optionally check if they are an admin.
                // Replace 'admins' with the actual path to your admin data
                dbRef.child('admins').child(user.uid).once('value', adminSnapshot => {
                    if (adminSnapshot.exists()) {
                        // User is an admin, proceed to load dashboard data
                        loadDashboardData(user.uid); // Use the authenticated user's UID
                    } else {
                        // User is logged in but not an admin, redirect or show an error
                        console.log("User is not an administrator.");
                        window.location.href = 'index.html?unauthorized=true'; // Redirect with an error message
                    }
                    hideLoading(); // Hide loading after checking admin status
                }, error => {
                    console.error("Error checking admin status:", error);
                    hideLoading();
                    alert("Failed to load dashboard data.");
                });
            } else {
                // User is not signed in, redirect to login
                window.location.href = 'index.html';
                hideLoading(); // Hide loading if not logged in
            }
        });

        const totalBooksElement = document.getElementById('totalBooks');
        const availableBooksElement = document.getElementById('availableBooks');
        const totalMembersElement = document.getElementById('totalMembers');
        const activeCheckoutsElement = document.getElementById('activeCheckouts');
        const overdueBooksElement = document.getElementById('overdueBooks');
        const totalFinesElement = document.getElementById('totalFines');
        const transactionsTableBody = document.getElementById('transactionsTable');
        const recentBooksGrid = document.getElementById('recentBooks');
        const adminNameElement = document.getElementById('adminName');
        const currentDateElement = document.getElementById('currentDate');
        const profileImageElement = document.getElementById('profileImage');

        const specificDate = new Date('2025-05-11T00:00:00');
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        currentDateElement.textContent = specificDate.toLocaleDateString('en-US', options);

        // Function to get data as an array from a Firebase snapshot
        const snapshotToArray = (snapshot) => {
            const dataArray = [];
            snapshot.forEach(childSnapshot => {
                const item = childSnapshot.val();
                item.id = childSnapshot.key;
                dataArray.push(item);
            });
            return dataArray;
        };

        function loadDashboardData(uid) {
            showLoading(); // Show loading before fetching data

            // Fetch admin profile data using the authenticated UID
            dbRef.child('admins').child(uid).once('value', adminSnapshot => {
                if (adminSnapshot.exists()) {
                    const adminData = adminSnapshot.val();
                    const adminName = adminData.fullName || 'Administrator';
                    adminNameElement.textContent = `Welcome, ${adminName}`;

                    if (adminData.profileImageURL) {
                        profileImageElement.src = adminData.profileImageURL;
                    } else {
                        profileImageElement.src = 'path/to/default-profile.png';
                    }
                } else {
                    // This should ideally not happen if the onAuthStateChanged check works correctly
                    adminNameElement.textContent = 'Welcome, Administrator';
                    profileImageElement.src = 'path/to/default-profile.png';
                }
            });

            // Fetch total books and available books
            dbRef.child('books').once('value', snapshot => {
                totalBooksElement.textContent = snapshot.numChildren();
                const availableCount = snapshotToArray(snapshot).filter(book => book.status === BOOK_STATUS.AVAILABLE).length;
                availableBooksElement.textContent = availableCount;
            });

            // Fetch total members
            dbRef.child('members').once('value', snapshot => {
                totalMembersElement.textContent = snapshot.numChildren();
            });

            // Fetch active checkouts and overdue books
            dbRef.child('transactions').once('value', snapshot => {
                const transactions = snapshotToArray(snapshot);
                const activeCheckouts = transactions.filter(transaction => transaction.status === 'checked_out').length;
                activeCheckoutsElement.textContent = activeCheckouts;

                const now = new Date();
                let overdueCount = 0;
                transactions.forEach(transaction => {
                    if (transaction.status === 'checked_out' && transaction.dueDate) {
                        const dueDate = new Date(transaction.dueDate);
                        if (dueDate < now) {
                            overdueCount++;
                        }
                    }
                });
                overdueBooksElement.textContent = overdueCount;
            });

            // Fetch total outstanding fines (you might need a specific 'fines' node in your database)
            dbRef.child('fines').once('value', snapshot => {
                let total = 0;
                snapshot.forEach(childSnapshot => {
                    const fine = childSnapshot.val();
                    if (fine && fine.amount && !fine.paid) {
                        total += parseFloat(fine.amount);
                    }
                });
                totalFinesElement.textContent = `₹${total.toFixed(2)}`;
            });

            // Fetch recent transactions (limit to the last few)
            dbRef.child('transactions').orderByChild('checkoutDate').limitToLast(5).once('value', snapshot => {
                transactionsTableBody.innerHTML = '';
                const recentTransactions = snapshotToArray(snapshot).reverse();
                recentTransactions.forEach(transaction => {
                    dbRef.child('members').child(transaction.memberId).once('value', memberSnapshot => {
                        dbRef.child('books').child(transaction.bookId).once('value', bookSnapshot => {
                            if (memberSnapshot.exists() && bookSnapshot.exists()) {
                                const member = memberSnapshot.val();
                                const book = bookSnapshot.val();
                                const row = transactionsTableBody.insertRow();
                                const memberCell = row.insertCell();
                                const bookCell = row.insertCell();
                                const checkoutDateCell = row.insertCell();
                                const dueDateCell = row.insertCell();
                                const statusCell = row.insertCell();

                                memberCell.textContent = member.name || 'N/A';
                                bookCell.textContent = book.title || 'N/A';
                                checkoutDateCell.textContent = transaction.checkoutDate ? new Date(transaction.checkoutDate).toLocaleDateString() : 'N/A';
                                dueDateCell.textContent = transaction.dueDate ? new Date(transaction.dueDate).toLocaleDateString() : 'N/A';
                                statusCell.textContent = transaction.status || 'N/A';
                                if (transaction.status === 'checked_out' && transaction.dueDate && new Date(transaction.dueDate) < new Date()) {
                                    statusCell.classList.add('overdue');
                                }
                            }
                        });
                    });
                });
            });

            // Fetch recently added books (limit to the last few)
            dbRef.child('books').orderByChild('addedDate').limitToLast(6).once('value', snapshot => {
                recentBooksGrid.innerHTML = '';
                const recentBooks = snapshotToArray(snapshot).reverse();
                recentBooks.forEach(book => {
                    const bookCard = document.createElement('div');
                    bookCard.classList.add('book-card');

                    const coverDiv = document.createElement('div');
                    coverDiv.classList.add('book-cover');
                    // Replace the text content with an image if coverPhotoURL exists
                    if (book.coverPhotoURL) {
                        const img = document.createElement('img');
                        img.src = book.coverPhotoURL;
                        img.alt = book.title + ' Cover';
                        img.style.width = '80px'; // Set the width as needed
                        img.style.height = '100px'; // Set the height as needed
                        img.style.borderRadius = '4px'; // Match the existing style
                        img.style.objectFit = 'cover';
                        coverDiv.appendChild(img);
                    } else {
                        coverDiv.textContent = book.title ? book.title.substring(0, 2).toUpperCase() : 'BK'; // Simple initials as fallback
                    }

                    const titleHeading = document.createElement('h3');
                    titleHeading.textContent = book.title || 'Untitled';

                    const authorPara = document.createElement('p');
                    authorPara.classList.add('book-author');
                    authorPara.textContent = book.author || 'Unknown Author';

                    const statusSpan = document.createElement('span');
                    statusSpan.classList.add('book-status');
                    statusSpan.classList.add(book.status);
                    statusSpan.textContent = book.status === BOOK_STATUS.AVAILABLE ? 'Available' : 'Checked Out';

                    const link = document.createElement('a');
                    link.href = `books.html?id=${book.id}`; // Link to book details page
                    link.classList.add('book-link');
                    link.textContent = 'View Details';

                    bookCard.appendChild(coverDiv);
                    bookCard.appendChild(titleHeading);
                    bookCard.appendChild(authorPara);
                    bookCard.appendChild(statusSpan);
                    bookCard.appendChild(link);

                    recentBooksGrid.appendChild(bookCard);
                });
            }).finally(hideLoading); // Hide loading after all data is fetched or on error
        }

        // Logout functionality
        const logoutBtn = document.getElementById('logoutBtn');
        logoutBtn.addEventListener('click', () => {
            firebase.auth().signOut()
                .then(() => {
                    window.location.href = 'index.html'; // Redirect to login page
                })
                .catch((error) => {
                    console.error('Logout failed:', error);
                    alert('Logout failed. Please try again.');
                });
        });
    });
</script>
<script>
    // <![CDATA[  <-- For SVG support
    if ('WebSocket' in window) {
        (function () {
            function refreshCSS() {
                var sheets = [].slice.call(document.getElementsByTagName("link"));
                var head = document.getElementsByTagName("head")[0];
                for (var i = 0; i < sheets.length; ++i) {
                    var elem = sheets[i];
                    var parent = elem.parentElement || head;
                    parent.removeChild(elem);
                    var rel = elem.rel;
                    if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
                        var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
                        elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
                    }
                    parent.appendChild(elem);
                }
            }
            var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
            var address = protocol + window.location.host + window.location.pathname + '/ws';
            var socket = new WebSocket(address);
            socket.onmessage = function (msg) {
                if (msg.data == 'reload') window.location.reload();
                else if (msg.data == 'refreshcss') refreshCSS();
            };
            if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_Live-Server')) {
                console.log('Live reload enabled.');
                sessionStorage.setItem('IsThisFirstTime_Log_From_Live-Server', true);
            }
        })();
    }
    else {
        console.error('Upgrade your browser. This page cannot work properly.');
    }
    // ]]>
</script>
</body>
</html>